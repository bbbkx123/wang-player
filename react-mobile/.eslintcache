[{"D:\\web\\wang-player\\react-mobile\\src\\index.tsx":"1","D:\\web\\wang-player\\react-mobile\\src\\App.tsx":"2","D:\\web\\wang-player\\react-mobile\\src\\store\\index.ts":"3","D:\\web\\wang-player\\react-mobile\\src\\store\\detail\\reducer.ts":"4","D:\\web\\wang-player\\react-mobile\\src\\store\\playpage\\reducer.ts":"5","D:\\web\\wang-player\\react-mobile\\src\\store\\playlist\\reducer.ts":"6","D:\\web\\wang-player\\react-mobile\\src\\store\\global\\reducer.ts":"7","D:\\web\\wang-player\\react-mobile\\src\\store\\recommend\\reducer.ts":"8","D:\\web\\wang-player\\react-mobile\\src\\store\\audio\\reducer.ts":"9","D:\\web\\wang-player\\react-mobile\\src\\views\\Layouts\\index.tsx":"10","D:\\web\\wang-player\\react-mobile\\src\\store\\types.ts":"11","D:\\web\\wang-player\\react-mobile\\src\\router\\index.ts":"12","D:\\web\\wang-player\\react-mobile\\src\\components\\Player\\index.tsx":"13","D:\\web\\wang-player\\react-mobile\\src\\components\\MiniController\\index.tsx":"14","D:\\web\\wang-player\\react-mobile\\src\\components\\MiniList\\index.tsx":"15","D:\\web\\wang-player\\react-mobile\\src\\store\\action.ts":"16","D:\\web\\wang-player\\react-mobile\\src\\views\\PlayPage\\index.tsx":"17","D:\\web\\wang-player\\react-mobile\\src\\views\\PlayListDetails\\index.tsx":"18","D:\\web\\wang-player\\react-mobile\\src\\views\\Recommend\\index.tsx":"19","D:\\web\\wang-player\\react-mobile\\src\\views\\Comment\\index.tsx":"20","D:\\web\\wang-player\\react-mobile\\src\\views\\Search\\index.tsx":"21","D:\\web\\wang-player\\react-mobile\\src\\store\\playpage\\action.ts":"22","D:\\web\\wang-player\\react-mobile\\src\\store\\audio\\action.ts":"23","D:\\web\\wang-player\\react-mobile\\src\\components\\List\\index.tsx":"24","D:\\web\\wang-player\\react-mobile\\src\\components\\Scroll\\index.tsx":"25","D:\\web\\wang-player\\react-mobile\\src\\views\\Search\\define.ts":"26","D:\\web\\wang-player\\react-mobile\\src\\views\\Recommend\\define.ts":"27","D:\\web\\wang-player\\react-mobile\\src\\views\\PlayListDetails\\define.ts":"28","D:\\web\\wang-player\\react-mobile\\src\\utils\\hook.ts":"29","D:\\web\\wang-player\\react-mobile\\src\\utils\\tools.ts":"30","D:\\web\\wang-player\\react-mobile\\src\\service\\index.tsx":"31","D:\\web\\wang-player\\react-mobile\\src\\components\\Loading\\index.tsx":"32","D:\\web\\wang-player\\react-mobile\\src\\service\\http.ts":"33","D:\\web\\wang-player\\react-mobile\\src\\components\\ProgressBar\\index.tsx":"34","D:\\web\\wang-player\\react-mobile\\src\\service\\config.ts":"35","D:\\web\\wang-player\\react-mobile\\src\\store\\testlog\\reducer.ts":"36","D:\\web\\wang-player\\react-mobile\\src\\store\\comment\\reducer.ts":"37","D:\\web\\wang-player\\react-mobile\\src\\views\\MoreDetails\\inedx.tsx":"38","D:\\web\\wang-player\\react-mobile\\src\\views\\MoreDetails\\define.ts":"39"},{"size":405,"mtime":1627282605821,"results":"40","hashOfConfig":"41"},{"size":265,"mtime":1626923301843,"results":"42","hashOfConfig":"41"},{"size":899,"mtime":1626923301890,"results":"43","hashOfConfig":"41"},{"size":1016,"mtime":1626923301887,"results":"44","hashOfConfig":"41"},{"size":1234,"mtime":1626923301894,"results":"45","hashOfConfig":"41"},{"size":510,"mtime":1626923301891,"results":"46","hashOfConfig":"41"},{"size":655,"mtime":1626923301889,"results":"47","hashOfConfig":"41"},{"size":656,"mtime":1626923301896,"results":"48","hashOfConfig":"41"},{"size":962,"mtime":1626923301884,"results":"49","hashOfConfig":"41"},{"size":2731,"mtime":1627282775252,"results":"50","hashOfConfig":"41"},{"size":1846,"mtime":1626923301899,"results":"51","hashOfConfig":"41"},{"size":1253,"mtime":1627283490762,"results":"52","hashOfConfig":"41"},{"size":2790,"mtime":1626923301867,"results":"53","hashOfConfig":"41"},{"size":2312,"mtime":1626923301862,"results":"54","hashOfConfig":"41"},{"size":1612,"mtime":1627282445674,"results":"55","hashOfConfig":"41"},{"size":314,"mtime":1626923301881,"results":"56","hashOfConfig":"41"},{"size":6938,"mtime":1627558105406,"results":"57","hashOfConfig":"41"},{"size":6029,"mtime":1627282280563,"results":"58","hashOfConfig":"41"},{"size":9420,"mtime":1627896910037,"results":"59","hashOfConfig":"41"},{"size":1858,"mtime":1626923301906,"results":"60","hashOfConfig":"41"},{"size":2611,"mtime":1626923301921,"results":"61","hashOfConfig":"41"},{"size":1638,"mtime":1627558453462,"results":"62","hashOfConfig":"41"},{"size":1931,"mtime":1627558109058,"results":"63","hashOfConfig":"41"},{"size":3617,"mtime":1626923301857,"results":"64","hashOfConfig":"41"},{"size":5269,"mtime":1626923301872,"results":"65","hashOfConfig":"41"},{"size":309,"mtime":1626923301920,"results":"66","hashOfConfig":"41"},{"size":951,"mtime":1627894542194,"results":"67","hashOfConfig":"41"},{"size":311,"mtime":1626923301911,"results":"68","hashOfConfig":"41"},{"size":2862,"mtime":1627896775822,"results":"69","hashOfConfig":"41"},{"size":3188,"mtime":1626923301903,"results":"70","hashOfConfig":"41"},{"size":3054,"mtime":1627286653743,"results":"71","hashOfConfig":"41"},{"size":1630,"mtime":1626923301860,"results":"72","hashOfConfig":"41"},{"size":915,"mtime":1627285203858,"results":"73","hashOfConfig":"41"},{"size":4343,"mtime":1626923301870,"results":"74","hashOfConfig":"41"},{"size":227,"mtime":1626923301878,"results":"75","hashOfConfig":"41"},{"size":359,"mtime":1626923301898,"results":"76","hashOfConfig":"41"},{"size":358,"mtime":1626923301885,"results":"77","hashOfConfig":"41"},{"size":2571,"mtime":1627896934254,"results":"78","hashOfConfig":"41"},{"size":702,"mtime":1627290092861,"results":"79","hashOfConfig":"41"},{"filePath":"80","messages":"81","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},"yn0866",{"filePath":"83","messages":"84","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"85","messages":"86","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"87","messages":"88","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"89","messages":"90","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"91","messages":"92","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"93","messages":"94","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"95","messages":"96","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"97","messages":"98","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"99","messages":"100","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"101","messages":"102","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"103","messages":"104","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"105","messages":"106","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"107","usedDeprecatedRules":"82"},{"filePath":"108","messages":"109","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"112","messages":"113","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"114","messages":"115","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"116","usedDeprecatedRules":"82"},{"filePath":"117","messages":"118","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"119","messages":"120","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"121","usedDeprecatedRules":"82"},{"filePath":"122","messages":"123","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"124","usedDeprecatedRules":"82"},{"filePath":"125","messages":"126","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"127","messages":"128","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"129","messages":"130","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"131","messages":"132","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"133","messages":"134","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"135","messages":"136","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"137","messages":"138","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"139","messages":"140","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"141","messages":"142","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"143","messages":"144","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"145","messages":"146","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"147","messages":"148","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"149","messages":"150","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"151","messages":"152","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"153","messages":"154","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"155"},{"filePath":"156","messages":"157","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"158","messages":"159","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},{"filePath":"160","messages":"161","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"162","usedDeprecatedRules":"82"},{"filePath":"163","messages":"164","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"82"},"D:\\web\\wang-player\\react-mobile\\src\\index.tsx",[],["165","166"],"D:\\web\\wang-player\\react-mobile\\src\\App.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\index.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\detail\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\playpage\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\playlist\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\global\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\recommend\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\audio\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\Layouts\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\types.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\router\\index.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\Player\\index.tsx",["167","168"],"import { useState, useEffect, useRef } from \"react\"\r\nimport { withRouter } from \"react-router-dom\"\r\nimport { useSelector, useDispatch } from \"react-redux\"\r\nimport action from \"@/store/action\"\r\n\r\nconst Player = (props: any) => {\r\n  const { history} = props\r\n\r\n  const dispatch = useDispatch()\r\n  const playList = useSelector((state: any) => state.playlist.data)\r\n  const currentSongIndex = useSelector((state: any) => state.playlist.currentSongIndex)\r\n  const showController = useSelector((state: any) => state.global.showController)\r\n  const testLog = useSelector((state: any) => state.test.log)\r\n\r\n  const audioElemRef = useRef<any>(null)\r\n  const [loop] = useState<boolean>(false)\r\n\r\n  // !问题: buffer加载时, currentTime需要loading效果\r\n  const onEnded = () => {\r\n    audioElemRef.current.pause()\r\n    dispatch({ type: \"audio/paused\", value: true })\r\n    if (playList.length > 0) {\r\n      if (currentSongIndex < playList.length - 1) {\r\n        if (!showController && window.location.pathname !== \"/play\") {\r\n          dispatch({ type: \"global/show-controller\", value: true })\r\n        }\r\n        dispatch(action.beforeCanPlayAction(currentSongIndex + 1))\r\n      } else if (currentSongIndex === playList.length - 1) {\r\n        // if (this.isLoopPlayList) {\r\n        //     this.songChangeIndex = 0\r\n        // }\r\n      }\r\n    }\r\n  }\r\n\r\n  const onTimeUpdate = (e: any) => {\r\n    let _currentTime = Math.floor(e.target.currentTime * 100) / 100\r\n    \r\n    // testLog.push(`onTimeUpdate ----- currentTime ：${_currentTime}`)\r\n    // dispatch({type: 'test/log', value: [...testLog]})\r\n\r\n    // 最初放在onCanplay，线上环境onCanplay执行audio.duration为0\r\n    dispatch({ type: \"audio/duration\", value: audioElemRef.current.duration })\r\n    dispatch({ type: \"audio/current-time\", value: _currentTime })\r\n  }\r\n\r\n  const onCanPlay = () => {\r\n    const { pathname } = history.location\r\n    dispatch({ type: \"audio/paused\", value: false })\r\n    // if (!showController && pathname !== \"/play\") dispatch({ type: \"global/show-controller\", value: true })\r\n  }\r\n\r\n  useEffect(() => {\r\n    audioElemRef.current.volume = 0.5\r\n    dispatch({ type: \"audio/instance\", value: audioElemRef.current })\r\n    return () => {}\r\n  }, []) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // *问题: react-hooks/exhaustive-deps\r\n  // 解决: 如果不需要在useEffect外使用方法, 可以简单的将方法移入useEffect内, 或者禁用\r\n\r\n  // *问题: 直接访问listDetail为null, 暂时将listDetail存入ref\r\n  // 在useEffect(() => {}, [])访问, listDetail是初始值null, 暂时这样实现\r\n\r\n  return <audio ref={audioElemRef} autoPlay={true} onEnded={onEnded} onTimeUpdate={onTimeUpdate} onCanPlay={onCanPlay} loop={loop}></audio>\r\n}\r\n\r\nexport default withRouter(Player)\r\n","D:\\web\\wang-player\\react-mobile\\src\\components\\MiniController\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\MiniList\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\action.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\PlayPage\\index.tsx",["169"],"import { useState, useEffect, useRef } from \"react\"\r\nimport { useSelector, useDispatch } from \"react-redux\"\r\nimport { withRouter } from \"react-router-dom\"\r\nimport ProgressBar from \"@/components/ProgressBar\"\r\nimport { changeSongAction } from \"@/store/audio/action\"\r\nimport { fetchLyricAction, getCurrentLineNumAction } from \"@/store/playpage/action\"\r\nimport { togglePlayAction } from \"@/store/audio/action\"\r\nimport { formatForPlayTime } from \"@/utils/tools\"\r\nimport { useReactiveSelector } from \"@/utils/hook\"\r\nimport List from \"@/components/List\"\r\nimport \"./index.less\"\r\n\r\nconst INITIAL_TOP = 200\r\nconst MOVE = -50\r\n\r\nconst PlayPage = (props: any) => {\r\n  const { history } = props\r\n  const ref = useRef<any>(null)\r\n  const cdWrapperElemRef = useRef<any>()\r\n  const lyricElemRef = useRef<any>()\r\n  const degRef = useRef<any>({\r\n    deg: null,\r\n    start: true,\r\n  })\r\n  const [showLyric, setShowLyric] = useState<boolean>(false)\r\n  const [displayCurrentTime, setDisplayCurrentTime] = useState<string>('')\r\n  const [displayDuration, setDisplayDuration] = useState<string>('')\r\n\r\n  const dispatch = useDispatch()\r\n  const playList = useSelector((state: any) => state.playlist.data)\r\n  const currentSongIndex = useSelector((state: any) => state.playlist.currentSongIndex)\r\n  const duration = useSelector((state: any) => state.audio.duration)\r\n  const lyric = useSelector((state: any) => state.playpage.lyric)\r\n  const currentLyricLine = useSelector((state: any) => state.playpage.currentLyricLine)\r\n  const songId = useSelector((state: any) => state.playpage.songId)\r\n  const percent = useSelector((state: any) => state.playpage.percent)\r\n  const paused = useSelector((state: any) => state.audio.paused)\r\n  const currentTime = useSelector((state: any) => state.audio.currentTime)\r\n  const isProgressChanging = useReactiveSelector((state: any) => state.playpage.isProgressChanging)\r\n\r\n  const testLog = useSelector((state: any) => state.test.log)\r\n\r\n  /**\r\n   * 问题: 在useEffect(()=>{}, [])中, timeupdate回调中无法读取 currentTime 和 duration, 暂时使用useEffect来更新percent\r\n   * 解决: 独立使用useEffect, useEffect(()=>{}, [currentTime, duration])可以获取到\r\n   * 后续发现不存在问题, 待观察\r\n   */\r\n\r\n  // 初始audio实例\r\n  // 1. 通过audio.current.src直接设置无效, 在标签中设置src可以生效 src={xxx}\r\n  // 2. chrome66以及更高的版本不允许媒体自动播放, 76前可以通过设置  chrome://flags/#autoplay-policy 设置 autoplay-policy 为  “No user gesture is required”\r\n  //  77需要通过查看网站信息 设置允许声音\r\n\r\n  const togglePlay = () => {\r\n    dispatch(togglePlayAction())\r\n  }\r\n\r\n  const handleNextSong = () => {\r\n    dispatch(changeSongAction(\"NEXT\"))\r\n  }\r\n\r\n  const handlePrevSong = () => {\r\n    dispatch(changeSongAction(\"PREV\"))\r\n  }\r\n\r\n  const rotate = (deg: number) => {\r\n    if (cdWrapperElemRef.current && cdWrapperElemRef.current.style) {\r\n      cdWrapperElemRef.current.style.transform = `rotate(${deg}deg)`\r\n    }\r\n  }\r\n\r\n  const image = () => {\r\n    if (playList[currentSongIndex].album.picUrl) {\r\n      return playList[currentSongIndex].album.picUrl + \"?param=300y300\"\r\n    } else {\r\n      return process.env.PUBLIC_URL + \"/image/wink.png\"\r\n    }\r\n  }\r\n\r\n  const scroll = () => {\r\n    if (lyricElemRef.current) {\r\n      lyricElemRef.current.style.top = INITIAL_TOP + currentLyricLine * MOVE + \"px\"\r\n    }\r\n  }\r\n\r\n  const toggleMainView = () => {\r\n    setShowLyric((prev) => {\r\n      degRef.current.start = prev\r\n      degRef.current.deg = 0\r\n      return !prev\r\n    })\r\n  }\r\n\r\n  const pageToComment = (e: any) => {\r\n    e.stopPropagation()\r\n    history.push({ pathname: \"/comment\" })\r\n  }\r\n\r\n  useEffect(() => {\r\n    // if (lyric.lyricList.length === 0) dispatch(fetchLyricAction(songId))\r\n    degRef.current.deg = 0\r\n  }, []) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (!isProgressChanging.current) {\r\n      const percent = Math.floor((currentTime / duration) * 10000) / 10000\r\n      // console.log(percent, currentTime, duration);\r\n      dispatch({ type: \"play-page/percent\", value: percent })\r\n    }\r\n    dispatch(getCurrentLineNumAction(currentTime))\r\n\r\n    if (degRef.current.start) {\r\n      degRef.current.deg = (degRef.current.deg || 0) + 2\r\n      if (degRef.current.deg >= 360) degRef.current.deg = 0\r\n      rotate(degRef.current.deg)\r\n    }\r\n  }, [currentTime]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    // if (!songId || songId === ref.current) return\r\n    ref.current = songId\r\n    dispatch(fetchLyricAction(songId))\r\n  }, [songId]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => scroll(), [currentLyricLine]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (showLyric) scroll()\r\n  }, [showLyric]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    setDisplayCurrentTime(formatForPlayTime(duration * percent))\r\n  }, [duration, currentTime]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    setDisplayDuration(formatForPlayTime(duration))\r\n  }, [duration]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <div className=\"play\">\r\n      <div className=\"play--main-container\" onClick={toggleMainView}>\r\n        {!showLyric ? (\r\n          <div className=\"play--main\">\r\n            <div ref={cdWrapperElemRef} className=\"play--cd-wrapper\">\r\n              {playList[currentSongIndex] && <img src={image()} alt=\"\" />}\r\n            </div>\r\n            <div className=\"play--other-btn\" onClick={pageToComment}>\r\n              <div style={{ fontSize: \"24px\", width: \"30px\" }} className=\"iconfont iconcomment\"></div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"play--lyric\" ref={(ref) => (lyricElemRef.current = ref)}>\r\n            {lyric && lyric.lyricList.length > 0 && <List mode=\"LYRIC\" data={lyric.lyricList} current={currentLyricLine}></List>}\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"edit-container\">\r\n        <div className=\"play--progress\">\r\n          <span className=\"time left\">{displayCurrentTime}</span>\r\n          <div style={{ width: \"calc(100% - 70px)\" }}>\r\n            <ProgressBar percent={percent}></ProgressBar>\r\n          </div>\r\n          <span className=\"time right\">{displayDuration}</span>\r\n        </div>\r\n        <div className=\"play--control\">\r\n          <div style={{ fontSize: \"32px\" }} className=\"iconfont iconprev\" onClick={handlePrevSong}></div>\r\n          <div style={{ fontSize: \"48px\" }} className={`iconfont ${typeof paused === \"boolean\" && !paused ? \"iconpause-circle\" : \"iconstart\"}`} onClick={togglePlay}></div>\r\n          <div style={{ fontSize: \"32px\" }} className=\"iconfont iconnext\" onClick={handleNextSong}></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(PlayPage)\r\n","D:\\web\\wang-player\\react-mobile\\src\\views\\PlayListDetails\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\Recommend\\index.tsx",["170"],"import { useState, useEffect, useCallback } from \"react\";\r\nimport { useSelector, useDispatch, useStore } from \"react-redux\";\r\nimport {Toast} from \"antd-mobile\"\r\n\r\nimport Scroll from \"@/components/Scroll\";\r\nimport List from \"@/components/List\";\r\nimport Loading from \"@/components/Loading\";\r\n\r\nimport * as api from \"@/service\";\r\nimport * as define from \"./define\";\r\nimport { formatForNewSongList } from \"@/utils/tools\";\r\nimport { beforeCanPlayAction } from \"@/store/audio/action\";\r\nimport { useAsync, useTouchEvent } from \"@/utils/hook\";\r\n\r\nimport \"./index.less\";\r\n\r\nconst useBanners = (dispatch: Function, state: any) => {\r\n  const { loading, execute, data, error } = useAsync(\r\n    useCallback(async () => await api.fetchBanner(0), [])\r\n  );\r\n  useEffect(() => {\r\n    if (state.recommend.banners.length <= 0) execute();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    const banners = data?.data?.banners;\r\n    if (Array.isArray(banners) && banners.length > 0)\r\n      dispatch({ type: \"views/recommend/banners\", value: banners });\r\n  }, [data]); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n  };\r\n};\r\n\r\nconst usePersonalization = (dispatch: Function, state: any) => {\r\n  const { loading, execute, data, error } = useAsync(\r\n    useCallback(async () => await api.fetchPersonalization(6), [])\r\n  );\r\n  useEffect(() => {\r\n    if (state.recommend.personalization.length <= 0) execute();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    const personalization = data?.data?.result;\r\n    if (Array.isArray(personalization) && personalization.length > 0)\r\n      dispatch({\r\n        type: \"views/recommend/personalization\",\r\n        value: personalization,\r\n      });\r\n  }, [data]); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n  };\r\n};\r\n\r\nconst useNewSong = (dispatch: Function, state: any) => {\r\n  const { loading, execute, data, error } = useAsync(\r\n    useCallback(async () => await api.fetchNewSong(6), [])\r\n  );\r\n  useEffect(() => {\r\n    if (state.recommend.newSongList.length <= 0) execute();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    const newSong = data?.data?.result;\r\n    if (Array.isArray(newSong) && newSong.length > 0) {\r\n      let list = newSong.map((item: any) => formatForNewSongList(item));\r\n      dispatch({ type: \"views/recommend/new-song-list\", value: list });\r\n    }\r\n  }, [data]); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n  };\r\n};\r\n\r\nconst Recommend = (props: any) => {\r\n  const { history } = props;\r\n  const [icons] = useState<any[]>(define.icons);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n\r\n  const dispatch = useDispatch();\r\n  const store = useStore();\r\n  const banners = useSelector((state: any) => state.recommend.banners);\r\n  const personalization = useSelector(\r\n    (state: any) => state.recommend.personalization\r\n  );\r\n  const newSongList = useSelector((state: any) => state.recommend.newSongList);\r\n  const showController = useSelector(\r\n    (state: any) => state.global.showController\r\n  );\r\n\r\n  const { loading: bannersLoading } = useBanners(dispatch, store.getState());\r\n  const { loading: personalizationLoading } = usePersonalization(\r\n    dispatch,\r\n    store.getState()\r\n  );\r\n  const { loading: newSongLoading } = useNewSong(dispatch, store.getState());\r\n\r\n  const { onTouchStart, onTouchEnd } = useTouchEvent((songIndex: number) => {\r\n    dispatch({ type: \"play-list/data\", value: [newSongList[songIndex]] });\r\n    if (!showController && window.location.pathname !== \"/play\") {\r\n      dispatch({ type: \"global/show-controller\", value: true });\r\n    }\r\n    dispatch(beforeCanPlayAction(0));\r\n  });\r\n\r\n  \r\n\r\n  useEffect(() => {\r\n    const isBoolean = [\r\n      bannersLoading,\r\n      personalizationLoading,\r\n      newSongLoading,\r\n    ].every((item: any) => typeof item === \"boolean\");\r\n    // 问题: loading会闪一下\r\n    /*\r\n      原因: 首次加载, isBoolean为false后再变为true, setLoading快速改变; \r\n      如果!isBoolean时setLoading(true)会造成后续回到recommend页面一直处于loading\r\n    */\r\n    if (!isBoolean) {\r\n      setLoading(false);\r\n    } else {\r\n      const loadingResult =\r\n        bannersLoading || personalizationLoading || newSongLoading;\r\n      if (!loadingResult) {\r\n        setTimeout(() => setLoading(loadingResult), 500);\r\n      } else {\r\n        setLoading(loadingResult);\r\n      }\r\n    }\r\n  }, [bannersLoading, personalizationLoading, newSongLoading]);\r\n\r\n  const pageToPlaylistDetail = (id: number) => {\r\n    history.push({ pathname: \"/playlistdetails\", query: { id } });\r\n  };\r\n\r\n  const toMoreDetail = useCallback(() => {\r\n    history.push({ pathname: \"/moredetails\" });\r\n  }, [])\r\n\r\n  const testTouch = (index: number) => {\r\n    // 纯音乐 453208524    like 129219563   英文 3185023336\r\n    if (index === 1) {\r\n      // pageToPlaylistDetail(3185023336);\r\n      history.push({ pathname: \"/moredetails\" });\r\n    } else if (index === 0) {\r\n      const playList = [\r\n        {\r\n          artists: \"Ellis/Laura Brehm\",\r\n          name: \"Start Over\",\r\n          album: { name: \"Start Over\" },\r\n          sid: 573027032,\r\n        },\r\n      ];\r\n      const songIndex = 0;\r\n      dispatch({ type: \"play-list/data\", value: playList });\r\n      if (!showController && window.location.pathname !== \"/play\") {\r\n        dispatch({ type: \"global/show-controller\", value: true });\r\n      }\r\n      dispatch(beforeCanPlayAction(songIndex));\r\n    } else {\r\n      Toast.offline('功能还未实现(；°○° )', 1);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"page-container\">\r\n      {loading && <Loading></Loading>}\r\n      {!loading && (\r\n        <Scroll\r\n          mode=\"normal-scroll-y\"\r\n          config={{ bscroll: define.recommendPageConf }}\r\n        >\r\n          <div className=\"banner-container\">\r\n            {banners.length > 0 && (\r\n              <Scroll\r\n                mode=\"banner\"\r\n                config={{ bscroll: define.sliderConf }}\r\n                width=\"100%\"\r\n              >\r\n                {banners.map((banner: any, index: number) => {\r\n                  return (\r\n                    <img\r\n                      style={{ width: \"100%\", height: 140 }}\r\n                      src={`${banner.imageUrl}?param=375y140`}\r\n                      key={`banner-${index}`}\r\n                      alt=\"\"\r\n                    />\r\n                  );\r\n                })}\r\n              </Scroll>\r\n            )}\r\n          </div>\r\n          <div className=\"icon-wrapper\">\r\n            <Scroll\r\n              mode=\"normal-scroll-x\"\r\n              config={{ bscroll: define.iconSliderConf }}\r\n              height={70}\r\n              width={50}\r\n            >\r\n              {icons.map((item, index) => {\r\n                return (\r\n                  <div\r\n                    className=\"children-item\"\r\n                    key={`icon-${index}`}\r\n                    onClick={() => testTouch(index)}\r\n                  >\r\n                    <img\r\n                      style={{ height: 50, width: 50 }}\r\n                      src={\r\n                        process.env.PUBLIC_URL + \"/image/\" + item.name + \".png\"\r\n                      }\r\n                      alt=\"\"\r\n                    />\r\n                    <span>{item.name}</span>\r\n                  </div>\r\n                );\r\n              })}\r\n            </Scroll>\r\n          </div>\r\n          <div className=\"recommend-wrapper\">\r\n            <p className=\"recommend-wrapper--title\">\r\n              <span className=\"text\">推荐歌单</span>\r\n              <span\r\n                onTouchStart={toMoreDetail}\r\n                className=\"text\"\r\n                style={{ fontSize: \"12px\", lineHeight: \"18px\" }}\r\n              >\r\n                更多歌单\r\n              </span>\r\n            </p>\r\n            {personalization.length > 0 && (\r\n              <Scroll\r\n                mode=\"normal-scroll-x\"\r\n                config={{ bscroll: define.personalizeConf }}\r\n                height={175}\r\n                width={140}\r\n              >\r\n                {personalization.map((item: any, index: number) => {\r\n                  return (\r\n                    <div\r\n                      className=\"children-item\"\r\n                      key={`recommend-detail-${index}`}\r\n                      onClick={() => pageToPlaylistDetail(item.id)}\r\n                    >\r\n                      <img\r\n                        src={`${item.picUrl}?param=140y140`}\r\n                        alt={item.name}\r\n                      />\r\n                      <span className=\"text\">{item.name}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </Scroll>\r\n            )}\r\n          </div>\r\n          <div className=\"new-song-list--wrapper\">\r\n            <p className=\"title\">不可错过的精选</p>\r\n            {newSongList.length > 0 && (\r\n              <List\r\n                data={newSongList}\r\n                mode=\"NEW_SONG\"\r\n                onTouchStart={onTouchStart}\r\n                onTouchEnd={onTouchEnd}\r\n              ></List>\r\n            )}\r\n            <div style={{ width: \"100%\", height: 100 }}></div>\r\n          </div>\r\n        </Scroll>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Recommend;\r\n","D:\\web\\wang-player\\react-mobile\\src\\views\\Comment\\index.tsx",["171"],"import * as api from \"@/service/index\"\r\nimport { useCallback, useEffect } from \"react\"\r\nimport { useSelector, useStore, useDispatch } from \"react-redux\"\r\nimport { useAsync, useTouchEvent } from \"@/utils/hook\"\r\nimport List from \"@/components/List\"\r\nimport Scroll from \"@/components/Scroll\"\r\nimport Loading from \"@/components/Loading\"\r\n\r\nimport \"./index.less\"\r\n\r\nconst commentPageConf = {\r\n  scrollY: true,\r\n  scrollX: false,\r\n  // 锁定方向\r\n  directionLockThreshold: 0,\r\n  freeScroll: false,\r\n}\r\n\r\nconst useComment = (songId: string, state: any, dispatch: Function)  => {\r\n  const { loading, data, error, execute } = useAsync(useCallback(async () => await api.fetchMusicComment(songId, 20, 0), [songId]))\r\n\r\n  useEffect(() => execute(), [songId]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    const comments = data?.data?.comments\r\n    if (Array.isArray(comments) && comments.length > 0) {\r\n      dispatch({ type: \"views/comment/data\", value: comments })\r\n    }\r\n  }, [data]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n  }\r\n}\r\n\r\nconst Comment = () => {\r\n  const store = useStore()\r\n  const dispatch = useDispatch()\r\n  const songId = useSelector((state: StoreState) => state.playpage.songId)\r\n  const comment = useSelector((state: any) => state.comment.data)\r\n  const {loading, error} = useComment(songId, store.getState(), dispatch)\r\n  const {onTouchStart, onTouchEnd} = useTouchEvent(() => {})\r\n\r\n  return (\r\n    <div className=\"page-container\">\r\n      {loading && <Loading></Loading>}\r\n      {comment && (\r\n        <Scroll mode=\"normal-scroll-y\" config={commentPageConf}>\r\n          <List mode=\"COMMENT_LIST\" data={comment} onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}></List>\r\n        </Scroll>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Comment\r\n","D:\\web\\wang-player\\react-mobile\\src\\views\\Search\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\playpage\\action.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\audio\\action.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\List\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\Scroll\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\Search\\define.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\Recommend\\define.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\PlayListDetails\\define.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\utils\\hook.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\utils\\tools.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\service\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\Loading\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\service\\http.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\components\\ProgressBar\\index.tsx",[],"D:\\web\\wang-player\\react-mobile\\src\\service\\config.ts",[],["172","173"],"D:\\web\\wang-player\\react-mobile\\src\\store\\testlog\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\store\\comment\\reducer.ts",[],"D:\\web\\wang-player\\react-mobile\\src\\views\\MoreDetails\\inedx.tsx",["174"],"import { useCallback, useEffect, useState } from \"react\";\r\nimport { withRouter } from \"react-router\";\r\nimport { Tabs } from \"antd-mobile\";\r\nimport Scroll from \"@/components/Scroll\";\r\nimport * as api from \"@/service/index\";\r\nimport { tabs as _tabs } from \"./define\";\r\nimport { instanceRef } from \"./define\";\r\n\r\nimport \"./index.less\";\r\n\r\nconst usePlayDetails = (tag: string) => {\r\n  const [details, setDetails] = useState([]);\r\n  useEffect(() => {\r\n    api\r\n      .fetchMorePlayListDetail(tag, 20, 0)\r\n      .then((res: any) => setDetails(res.data.playlists));\r\n  }, [tag]);\r\n  return details;\r\n};\r\n\r\nlet MoreDetails = (props: any) => {\r\n  const { history } = props;\r\n  const [tabs] = useState(_tabs);\r\n  const [active, setActive] = useState<any>(\"流行\");\r\n  const details = usePlayDetails(active);\r\n  const onChange = useCallback(\r\n    (tab: any, index: Number) => {\r\n      setActive(tab.title)\r\n    },\r\n    []\r\n  );\r\n  const pageToPlaylistDetail = useCallback(\r\n    (id: number) =>\r\n      history.push({ pathname: \"/playlistdetails\", query: { id } }),\r\n    []\r\n  );\r\n\r\n  return (\r\n    <div className=\"more-details\">\r\n      <Tabs\r\n        tabs={tabs}\r\n        renderTabBar={(props) => <Tabs.DefaultTabBar {...props} page={3} />}\r\n        tabBarBackgroundColor={\"#000\"}\r\n        onChange={onChange}\r\n        // distanceToChangeTab={0.9}\r\n        animated={false}\r\n      >\r\n        {/* onReload={onReload} fetchDataForPullUp={() => handleAppendPlayList(state, dispatch)} */}\r\n        <div style={{height: \"800px\"}}>\r\n          {details.length > 0 && (\r\n            <Scroll mode=\"list-detail\" config={instanceRef}>\r\n              <div style={{ display: \"flex\", flexWrap: \"wrap\" }}>\r\n                {details.map((detail: any, index) => {\r\n                  return (\r\n                    <div\r\n                      className={`more-details--item ${(index + 1) % 3 === 0 ? 'no-margin' : ''}` }\r\n                      key={`details-${index}`}\r\n                      onTouchStart={() => pageToPlaylistDetail(detail.id)}\r\n                    >\r\n                      <img\r\n                        style={{width:'100px', height: '100px'}}\r\n                        src={`${detail.coverImgUrl}?param=100y100`}\r\n                        alt={detail.description}\r\n                      />\r\n                      <span className=\"text\">{detail.name}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </Scroll>\r\n          )}\r\n        </div>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withRouter(MoreDetails);\r\n","D:\\web\\wang-player\\react-mobile\\src\\views\\MoreDetails\\define.ts",[],{"ruleId":"175","replacedBy":"176"},{"ruleId":"177","replacedBy":"178"},{"ruleId":"179","severity":1,"message":"180","line":13,"column":9,"nodeType":"181","messageId":"182","endLine":13,"endColumn":16},{"ruleId":"179","severity":1,"message":"183","line":48,"column":13,"nodeType":"181","messageId":"182","endLine":48,"endColumn":21},{"ruleId":"179","severity":1,"message":"180","line":41,"column":9,"nodeType":"181","messageId":"182","endLine":41,"endColumn":16},{"ruleId":"184","severity":1,"message":"185","line":142,"column":6,"nodeType":"186","endLine":142,"endColumn":8,"suggestions":"187"},{"ruleId":"179","severity":1,"message":"188","line":43,"column":19,"nodeType":"181","messageId":"182","endLine":43,"endColumn":24},{"ruleId":"175","replacedBy":"189"},{"ruleId":"177","replacedBy":"190"},{"ruleId":"184","severity":1,"message":"185","line":35,"column":5,"nodeType":"186","endLine":35,"endColumn":7,"suggestions":"191"},"no-native-reassign",["192"],"no-negated-in-lhs",["193"],"@typescript-eslint/no-unused-vars","'testLog' is assigned a value but never used.","Identifier","unusedVar","'pathname' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useCallback has a missing dependency: 'history'. Either include it or remove the dependency array.","ArrayExpression",["194"],"'error' is assigned a value but never used.",["192"],["193"],["195"],"no-global-assign","no-unsafe-negation",{"desc":"196","fix":"197"},{"desc":"196","fix":"198"},"Update the dependencies array to be: [history]",{"range":"199","text":"200"},{"range":"201","text":"200"},[4807,4809],"[history]",[1055,1057]]